软件安装总的分两种，编译安装、二进制包安装。各个 Linux 系统都有自己的包管理器，打包的格式也不相同。

二进制包分类：

- DPKG ： 应用于：Debian 和 Unbuntu 。
- RPM：Red Hat 系包格式。


### RPM 

- **依赖关系**： RPM 包有依赖关系，手动安装注意不同的依赖关系的解决。RPM 包查询 [Rpmfind mirror](https://rpmfind.net/)

- **文件写入位置**：安装的位置是分散的，但可能是默认的位置，具体文件位置是个常识。

- **安装**： 

  RPM 手动安装（首次）需要包全名，且绝对路径。如果已经安装过，可以用包名，因为RPM包数据库（`/var/lib/rpm` ）会缓存包的元信息，且无需注意路径问题。

  RPM 包管理器支持从远程 URL 直接安装 RPM 包。有的 `RPM` 包 是存储库配置包（ Yum 存储库配置），然后配合 `yum` 安装。

  数字证书：RPM 安装可能要校验 证书。可以选择导入证书或者忽略证书校验。

#### Questions:

##### 1. `RPM 包` 包命名规范是什么，什么是包名，包全名。

例如： httpd-2.4.6-99.el7.centos.1.x86_64.rpm ， 这是包全名，httpd是包名。

`httpd` : 软件包名

`2.4.6-99` 版本号

`x86_64` ： 硬件平台

什么时候是包名还是包全名，这取决于命令上下文，包全名指的就是 rpm文件，包名值得是RPM数据库的名称。

这背后的逻辑是：要查询的对象是一个 RPM 文件，还是系统上已安装的软件包。

##### 2. RPM 文件默认安装位置？

取决于RPM包的行为，不过有一般的约定。

| RPM 包安装        |                          |
| ----------------- | ------------------------ |
| `/etc/`           | 配置文件安装目录         |
| `/usr/bin/`       | 可执行文件（命令）的目录 |
| `/usr/lib/`       | 函数库                   |
| `/usr/share/doc/` | doc                      |
| `/usr/share/man/` | 帮助文档                 |



#### 命令：rpm

这些命令都是是 【snippet】的，按照场景记忆参数格式。

##### rpm install

```
rpm -ivh 包全名
	-i    install
	-v    verbose
	-h    hash（进度信息）
	
# 注意依赖问题，一般有下面的选项，注意，如果手动安装，各种依赖问题都有相应的解决办法
  --nodeps         不检测依赖性安装
  --replacefiles   替换文件安装
  --replacepkgs    替换软件包安装
  --force          强制安装
  --test           测试安装
```

软件包为了确认是否被动过，需要进行数字证书（RPM-GPG-KEY）校验。例如安装Mysql8.0 强制校验。

安装前导入数字证书

```shell
rpm --import RPM-GPG-KEY-xxx
```

忽略 GPG 验证。

```
rpm --nosignature -ivh package_name 
```

##### rpm upgrade

```
rpm -Uvh   包全名  
Option:    -U   Upgrade，不存在直接安装，已经安装的升级。

rpm -Fvh   包全名  
Option:    -F   Freshen，不存在不安装，已经安装的升级。
```

##### rpm 卸载

```shell
rpm -e 包名（不是包全名）
option:
	--nodeps    不检查依赖性
	-e          卸载（eras）
```

##### rpm 查询

主要分两类，查询 **RPM文件** 的信息，查询 **系统上** 安装的rpm包信息（ `-p` : package 。表示是一个 `rpm` 包）

**Question:** 

RPM 主要查询主要有哪些功能？

- 查询 系统上的 rpm包 是否被安装
- 查询系统所有已经安装的包名
- 查询软件包的详细信息
  - 查询 RPM 文件的元信息
  - 查询 系统上 rpm 包信息

- 查询软件包安装了哪些文件
  - 系统上的 rpm包 安装文件的具体位置
  - RPM 文件的将要安装的位置

- 查询系统文件属于哪个rpm包
- 查询软件所依赖的包
  - 系统上已安装的软件包
  - RPM 文件 依赖的包




```
# 软件包是否被安装。
rpm -q 包名

# 系统中所有已经安装的软件包，或者特定的包是否被安装
rpm -qa | grep xxx 

# 查询包的详细信息
rpm -qi 包名
rpm -qip 包全名    # 查询 RPM 文件的元信息

# 查询软件包的文件列表
rpm -ql 包名
rpm -qlp 包全名 


# 查询系统文件属于哪个rpm包
rpm -qf 系统文件名

# 查询软件依赖的包
rpm -qR 包名
rpm -qRp 包全名
```

**场景：**如何确定 RPM 文件（可能是手动下载的）是否已经被安装？（避免重复安装 RPM 包）

1. **查询文件的名称和版本**： 使用 `rpm -qip` 命令来查看 RPM 文件的名称和版本。例如：

 ```
   rpm -qip nano-2.3.1-10.el7.x86_64.rpm
```

   这将提供软件包的名称（如 `nano`）、版本（如 `2.3.1`）和发行版本（如 `10.el7`）。

2. **使用查询命令检查系统上的安装情况**： 接下来，使用 `rpm -q` 命令加上软件包的名称来查询系统上是否已安装该软件包及其版本。例如：

   ```
   rpm -q nano
   ```

   这将显示系统上安装的 `nano` 软件包的版本。

3. **比较版本信息**： 比较从 RPM 文件和系统查询中得到的版本信息。如果版本号相同，并且软件包名称相符，那么就可以确定特定的 RPM 文件已经安装在系统上。


##### rpm 文件提取

这部分一般是修复系统使用的 trick。 可以指定从rmp包抽取文件，主要借助 cpio rmp2cipo



#### 包管理器

yum 是一个软件包管理器， 它使用 `Repository` （本地或者远程）的概念分发和安装软件。

远程仓库被称为 `yum源` ，`yum源` 配置文件保存在`/etc/yum.repos.d/` 目录中，文件扩展名是 `*.repo`，也就是只要是位于这个目录下，扩展名是 `*.repo` 就会生效。

##### Question:

`yum 源` 有哪些配置项？

- 需要记住的有哪些？

  核心是下面三个配置可以描述一个yum源。

  ```
  [repositoryid]：
  存储库的唯一标识符。在方括号内，例如 [base]。
  
  name：
  存储库的描述性名称，例如 CentOS-$releasever - Base。
  
  baseurl：
  存储库的基础 URL，指明了 Yum 可以从哪里获取软件包，例如 http://mirror.centos.org/centos/$releasever/os/$basearch/
  ```

  其他：

  ```
  mirrorlist：
  包含多个基础 URL 的镜像列表的 URL。Yum 会从这个列表中选择一个 URL 来下载软件包。
  
  enabled：
  指明该存储库是否启用。1 表示启用，0 表示禁用。
  
  gpgcheck：
  是否进行 GPG 签名检查，以确保软件包的安全性。1 表示执行检查，0 表示不检查。
  
  gpgkey：
  GPG 密钥的 URL 或本地文件路径，用于验证软件包的签名。
  ```

Yum 命令都对应哪些功能？

- 安装、卸载、升级软件包
- 查询 【Yum 存储库】中可用的软件包列表
  - 查询特定包存在（支持通配符）
- 搜索关键字相关的包，利用这个功能可以确定哪个命令在哪个包中。



```shell
# 安装、升级、卸载软件包
yum install 包名 -y

yum update  包名 -y

yum remove  包名 -y

```



```shell
# 展示 Yum 服务器上所有可能安装的包列表
yum list 

# 查询 Yum 服务器上是否有特定的包
yum list 包名
yum info 包名

# 搜索 Yum 源服务器上所有和关键字相关的软件包
yum search 关键字

关键字可以是特定的命令，利用这点可以搜特定的命令需要安装哪些包
```







